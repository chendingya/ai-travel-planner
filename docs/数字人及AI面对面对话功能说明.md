# 数字人及AI面对面对话功能说明

本文档详细介绍了本项目中“数字人导游”和“AI面对面对话”两大核心功能的实现原理、功能特性及使用说明。这两个功能结合了最新的大语言模型（LLM）和语音合成（TTS）技术，旨在为用户提供沉浸式的智能旅游服务体验。

## 1. 数字人导游 (Digital Human)

数字人导游是一个悬浮在页面上的交互式组件，能够根据用户当前浏览的景点信息，实时生成并播放生动的导游讲解。

### 1.1 功能特性

*   **形象展示**：
    *   展示数字人形象，增强互动感。
    *   支持多个形象循环切换，避免视觉疲劳。
    *   **说话动画**：当播放语音时，数字人会有相应的说话动效（通过CSS动画模拟）。
*   **智能讲解**：
    *   **自动触发**：当用户在地图或列表中选中某个景点时，数字人会自动展开并开始讲解。
    *   **内容生成**：调用后端AI接口，根据景点名称、位置、描述等信息，实时生成生动有趣的导游词（约200-300字）。
*   **语音播放**：
    *   **多音色选择**：支持多种音色切换（如：芊悦、晨煦、程川、阿强、阿清），满足不同用户喜好。
    *   **自动播放**：生成完成后自动播放语音。
    *   **多段音频支持**：对于较长的讲解内容，支持自动分段播放，确保流畅体验。
    *   **播放控制**：提供暂停、停止、重新生成等控制功能。
*   **交互面板**：
    *   显示当前讲解的景点名称和简介。
    *   提供音色设置和自动播放开关。
    *   显示生成状态和错误提示。

### 1.2 技术实现

*   **前端组件**：`frontend/src/components/DigitalHuman.vue`
*   **状态管理**：使用Vue 3的响应式API (`ref`, `computed`, `watch`) 管理播放状态、展开状态和音频数据。
*   **后端接口**：调用 `/api/ai-chat` 接口，参数中包含 `include_audio: true` 和特定的提示词（Prompt），要求AI扮演导游角色。

### 1.3 使用场景

*   用户在浏览“景点地图”或“行程规划”时，点击感兴趣的景点，数字人即刻出现，提供类似真人导游的语音讲解服务。

---

## 2. AI面对面对话 (AI Face-to-Face Chat)

AI面对面对话是一个独立的页面视图，提供与AI旅行助手进行深度语音交流的平台。

### 2.1 功能特性

*   **沉浸式聊天界面**：
    *   采用现代化的聊天UI设计，区分用户和AI的消息气泡。
    *   背景采用渐变色，营造轻松的对话氛围。
*   **快捷提问**：
    *   提供“推荐热门景点”、“特色美食”等快捷问题按钮，方便用户快速开始对话。
*   **智能问答**：
    *   基于大语言模型，能够回答关于湖南旅游的各种问题，包括路线规划、交通指南、避坑建议等。


### 2.2 使用场景

*   用户在出行前需要制定详细计划，或者在旅途中遇到具体问题（如“现在去岳麓山人多吗？”）时，可以通过此功能获得即时、专业的解答。

---

## 3. 后端接口说明

两个功能均依赖于同一个后端服务 `tts-flask-backend`。

### 3.1 核心接口 `/api/ai-chat`

*   **Method**: `POST`
*   **功能**: 接收用户消息，调用LLM生成回复，并可选地调用TTS生成语音。
*   **请求参数**:
    ```json
    {
      "message": "用户输入的内容或Prompt",
      "voice": "Cherry", // 音色ID
      "language_type": "Chinese",
      "include_audio": true // 是否生成语音
    }
    ```
*   **响应结构**:
    ```json
    {
      "user_message": "...",
      "ai_response": "AI回复的文本内容",
      "voice": "...",
      "audio_url": "http://...", // 单段音频URL
      "audio_urls": ["http://...", "http://..."], // 多段音频URL列表（长文本时返回）
      "audio_task_id": "..." // 异步任务ID（如果音频未立即生成）
    }
    ```

### 3.2 音频状态查询 `/api/tts/audio/<task_id>`

*   **Method**: `GET`
*   **功能**: 用于轮询异步TTS任务的状态。
*   **响应**: 返回任务状态 (`processing`, `completed`, `failed`) 和最终的 `audio_url`。

## 4. 配置说明

要正常使用上述功能，需要在 `tts-flask-backend/.env` 文件中配置以下密钥：

*   `DASHSCOPE_API_KEY`: 用于语音合成 (阿里云 DashScope)。
*   `MODELSCOPE_API_KEY`: 用于大模型对话 (魔搭社区)。
