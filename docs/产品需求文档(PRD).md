# 产品需求文档（PRD）

**项目名称**：拾光绘旅  
**文档版本**：v1.0  
**创建日期**：2026-01-21  
**面向团队**：开发团队  
**详细程度**：标准版

---

## 1. 项目概述

### 1.1 产品定位

拾光绘旅是一款基于人工智能的智能旅行规划 Web 应用，通过先进的大语言模型和计算机视觉技术，为用户提供从行程规划到内容创作的一站式旅行体验。

**核心价值主张**：
- 🎯 **智能规划**：AI 驱动的个性化行程推荐
- 🎨 **内容创作**：自动生成速记卡片、明信片、文案等创意内容
- 🗺️ **可视化**：交互式地图展示和数字人导游
- ☁️ **云同步**：多设备数据同步和方案管理

### 1.2 目标用户

| 用户类型 | 需求描述 | 核心功能 |
|---------|---------|---------|
| **自由行用户** | 不想花时间规划行程 | 智能规划、地图导航 |
| **内容创作者** | 需要生成精美的旅行内容 | 速记卡片、明信片、分享文案 |
| **旅行爱好者** | 希望保存和分享旅行记忆 | 云端存储、BGM歌单 |
| **商务旅客** | 快速规划高效行程 | 预算管理、智能优化 |

### 1.3 产品愿景

成为国内领先的 AI 驱动的旅行规划平台，让每一次旅行都充满创造力和美好回忆。

---

## 2. 功能需求

### 2.1 核心功能矩阵

| 功能模块 | 功能点 | 优先级 | 状态 |
|---------|-------|--------|------|
| **用户认证** | Supabase OTP 登录 | P0 | ✅ 已实现 |
| **用户认证** | 自动会话恢复 | P0 | ✅ 已实现 |
| **用户认证** | 用户登出 | P0 | ✅ 已实现 |
| **智能规划** | 旅行表单填写 | P0 | ✅ 已实现 |
| **智能规划** | AI 行程生成 | P0 | ✅ 已实现 |
| **智能规划** | 方案保存到云端 | P0 | ✅ 已实现 |
| **智能规划** | 已保存方案列表 | P0 | ✅ 已实现 |
| **方案详情** | 日程展示 | P0 | ✅ 已实现 |
| **方案详情** | 预算分解 | P0 | ✅ 已实现 |
| **方案详情** | 地图可视化 | P0 | ✅ 已实现 |
| **数字人导游** | AI 导游讲解 | P1 | ✅ 已实现 |
| **数字人导游** | 语音播放控制 | P1 | ✅ 已实现 |
| **AI 速记卡片** | 手绘风格卡片生成 | P1 | ✅ 已实现 |
| **AI 速记卡片** | 图片下载 | P1 | ✅ 已实现 |
| **BGM 歌单** | 歌单生成 | P1 | ✅ 已实现 |
| **BGM 歌单** | 歌单下载 | P1 | ✅ 已实现 |
| **旅游明信片** | 明信片生成 | P1 | ✅ 已实现 |
| **旅游明信片** | 模板选择 | P1 | ✅ 已实现 |
| **分享文案** | 多平台文案生成 | P1 | ✅ 已实现 |
| **分享文案** | 风格选择 | P1 | ✅ 已实现 |
| **AI 对话** | 智能问答 | P1 | ✅ 已实现 |
| **AI 对话** | 工具调用（火车票、搜索）| P1 | ✅ 已实现 |
| **AI 对话** | 会话管理 | P1 | ✅ 已实现 |
| **AI 对话** | 语音合成 | P1 | ✅ 已实现 |

### 2.2 详细功能说明

#### 2.2.1 用户认证模块

**功能描述**：基于 Supabase OTP（一次性密码）的用户认证系统。

**用户故事**：
```
作为一个旅行者
我希望能够通过邮箱快速登录
这样我就可以在多个设备上同步我的旅行计划
```

**业务流程**：
```
用户输入邮箱 → 发送 OTP 请求 → Supabase 发送魔法链接邮件 → 
用户点击邮件链接 → 验证 token 并建立会话 → 登录成功
```

**功能需求**：
- **FR-AUTH-001**：用户输入邮箱后，点击"发送登录链接"按钮
  - 预期：显示"登录链接已发送，请查收邮件！"提示
  - 验收：按钮显示加载状态，成功后自动关闭对话框

- **FR-AUTH-002**：用户点击邮件中的魔法链接
  - 预期：自动跳转至应用并完成登录
  - 验收：右上角按钮显示用户邮箱

- **FR-AUTH-003**：自动会话恢复
  - 预期：刷新页面或重新打开浏览器后，登录状态保持
  - 验收：无需重新登录，继续使用

- **FR-AUTH-004**：用户登出
  - 预期：点击"退出登录"后，清除会话和本地存储
  - 验收：右上角按钮变回"登录"

**非功能性需求**：
- **NFR-AUTH-001**：登录链接有效期为 60 分钟
- **NFR-AUTH-002**：支持 Token 自动刷新机制
- **NFR-AUTH-003**：敏感信息（API Key）不暴露在前端

---

#### 2.2.2 智能行程规划模块

**功能描述**：基于用户输入（目的地、天数、预算、人数、偏好）生成个性化旅行计划。

**用户故事**：
```
作为一个计划去长沙旅行5天的用户
我希望输入目的地、天数、预算等信息后
能够自动生成详细的行程安排
包括每天的景点、餐饮、住宿和预算分解
```

**业务流程**：
```
用户填写表单 → 提交到后端 → 调用 DeepSeek AI 生成计划 → 
结构化数据存储 → 返回前端 → 用户查看并保存
```

**功能需求**：
- **FR-PLAN-001**：旅行信息表单
  - 输入字段：
    - 目的地（必填，文本）
    - 出发日期（必填，日期选择器）
    - 天数（必填，数字，1-30）
    - 预算（必填，数字，单位：元）
    - 人数（必填，数字，1-10）
    - 偏好（可选，多选：文化、美食、自然、购物、历史、休闲）
  - 预期：表单验证，所有必填项校验通过
  - 验收：点击"生成方案"按钮显示加载状态

- **FR-PLAN-002**：AI 行程生成
  - 预期：返回包含以下内容的 JSON：
    ```json
    {
      "destination": "长沙",
      "days": 5,
      "days_detail": [
        {
          "day": 1,
          "activities": [
            {
              "time": "上午",
              "activity": "游览岳麓山",
              "description": "岳麓山是长沙的标志性景点...",
              "cost": 0
            }
          ]
        }
      ],
      "total_budget": 3000,
      "budget_breakdown": {
        "住宿": 1200,
        "餐饮": 1000,
        "交通": 500,
        "门票": 300
      }
    }
    ```
  - 验收：生成时间 < 30 秒

- **FR-PLAN-003**：方案保存到云端
  - 预期：保存方案到 Supabase 数据库
  - 验收：成功后显示"保存成功"提示，方案出现在列表中

- **FR-PLAN-004**：已保存方案列表
  - 预期：展示用户所有保存的方案卡片
  - 卡片信息：目的地、天数、预算、创建时间
  - 验收：按创建时间倒序排列，支持删除

**非功能性需求**：
- **NFR-PLAN-001**：AI 生成响应时间 < 30 秒
- **NFR-PLAN-002**：方案数据大小 < 10KB
- **NFR-PLAN-003**：支持并发生成请求，最多 5 个

---

#### 2.2.3 方案详情模块

**功能描述**：展示已生成旅行方案的详细信息，包括日程、预算、地图和数字人导游。

**用户故事**：
```
作为一个查看旅行方案的用户
我希望能够看到每天的详细安排、预算分解
以及地图上的景点位置
这样我可以更好地规划行程
```

**功能需求**：
- **FR-DETAIL-001**：日程时间线展示
  - 展示内容：
    - 天数标签（Day 1, Day 2...）
    - 时间段（上午、下午、晚上）
    - 活动名称、描述、费用
  - 交互：点击展开/收起详情
  - 验收：时间线清晰，视觉层次分明

- **FR-DETAIL-002**：预算分解图表
  - 展示内容：
    - 预算分配饼图（住宿、餐饮、交通、门票）
    - 各项金额和百分比
    - 总预算显示
  - 验收：图表清晰，支持鼠标悬停显示详情

- **FR-DETAIL-003**：地图可视化
  - 使用高德地图展示景点位置
  - 标记点包含：景点名称、图标
  - 交互：点击标记显示详情，支持缩放
  - 验收：地图加载正常，标记位置准确

- **FR-DETAIL-004**：数字人导游
  - 功能：
    - AI 生成景点讲解文案
    - 语音合成播放
    - 播放控制（播放/暂停/停止）
  - 预期：自然流畅的语音讲解
  - 验收：语音清晰，无卡顿

**非功能性需求**：
- **NFR-DETAIL-001**：地图加载时间 < 3 秒
- **NFR-DETAIL-002**：语音合成延迟 < 2 秒

---

#### 2.2.4 内容创作模块

**功能描述**：为旅行方案生成多种创意内容，包括速记卡片、明信片、BGM歌单和分享文案。

**功能需求**：
- **FR-CREATE-001**：AI 速记卡片
  - 功能：生成手绘风格的旅行速记卡片
  - 输入：旅行方案 + 素材图片
  - 输出：PNG 图片（800x600）
  - 验收：图片质量高，艺术感强

- **FR-CREATE-002**：旅游明信片
  - 功能：生成旅游明信片
  - 模板选择：简约、复古、艺术
  - 输入：旅行方案 + 用户照片
  - 输出：PNG 图片（1200x800）
  - 验收：模板美观，文字清晰

- **FR-CREATE-003**：BGM 歌单
  - 功能：根据旅行目的地和主题生成歌单
  - 输出：包含 10-15 首歌曲的推荐列表
  - 字段：歌名、歌手、时长
  - 验收：歌曲与主题匹配

- **FR-CREATE-004**：分享文案
  - 功能：生成多平台分享文案
  - 平台：微信朋友圈、小红书、微博
  - 风格：文艺、活泼、简约
  - 输出：3-5 个文案选项
  - 验收：文案质量高，符合平台特性

**非功能性需求**：
- **NFR-CREATE-001**：图片生成时间 < 10 秒
- **NFR-CREATE-002**：文案生成时间 < 5 秒

---

#### 2.2.5 AI 对话模块

**功能描述**：智能旅行助手，支持自然语言问答和工具调用。

**功能需求**：
- **FR-CHAT-001**：智能问答
  - 支持问题类型：
    - 旅行攻略咨询
    - 景点信息查询
    - 当地文化、美食推荐
  - 预期：回答准确，上下文连贯
  - 验收：响应时间 < 3 秒

- **FR-CHAT-002**：工具调用
  - 支持工具：
    - `searchWeb`：搜索实时信息
    - `searchTrainTickets`：查询火车票
  - 预期：工具调用准确，返回结果可用
  - 验收：工具调用成功率 > 95%

- **FR-CHAT-003**：会话管理
  - 功能：保存历史会话，支持清除
  - 展示：最近 10 条对话
  - 验收：会话持久化，刷新不丢失

- **FR-CHAT-004**：语音合成
  - 功能：将 AI 回复转换为语音播放
  - 预期：自然流畅的语音
  - 验收：支持播放/暂停控制

**非功能性需求**：
- **NFR-CHAT-001**：对话响应时间 < 3 秒
- **NFR-CHAT-002**：支持最多 10 轮对话上下文

---

## 3. 用户界面需求

### 3.1 界面设计原则

- **简洁直观**：关键操作一步可达
- **视觉美观**：符合旅行主题，色彩明亮
- **响应式设计**：支持桌面端和移动端
- **交互反馈**：加载状态、成功/失败提示

### 3.2 核心页面

#### 3.2.1 首页
- Hero 区域：产品介绍和 CTA 按钮
- 功能展示：智能规划、内容创作、AI 对话
- 示例方案：展示优秀旅行方案

#### 3.2.2 智能规划页面
- 左侧：旅行信息表单
- 右侧：方案预览区（生成后显示）

#### 3.2.3 方案详情页面
- 顶部：方案标题和操作按钮
- 中部：日程时间线
- 侧边：预算分解和地图
- 底部：内容创作入口

#### 3.2.4 AI 对话页面
- 左侧：聊天窗口
- 右侧：工具面板（可选）

### 3.3 设计规范

| 元素 | 颜色 | 字体 | 尺寸 |
|-----|------|------|------|
| 主色调 | #FF6B6B（珊瑚红） | - | - |
| 辅助色 | #4ECDC4（青绿） | - | - |
| 背景色 | #F7F9FC | Inter/思源黑体 | - |
| 文本 | #2C3E50 | - | 14px/16px/18px |
| 按钮 | 主色填充 | - | 44px 高度 |

---

## 4. 数据需求

### 4.1 数据实体

#### 用户（users）
```sql
id (uuid, primary key)
email (varchar, unique)
created_at (timestamp)
```

#### 旅行方案（plans）
```sql
id (uuid, primary key)
user_id (uuid, foreign key)
destination (varchar)
days (integer)
start_date (date)
budget (decimal)
people_count (integer)
preferences (jsonb)
days_detail (jsonb)
budget_breakdown (jsonb)
created_at (timestamp)
```

### 4.2 数据存储策略

- 用户数据：Supabase PostgreSQL
- 会话状态：Supabase Auth + LocalStorage
- 缓存策略：Redis（可选）

### 4.3 数据安全

- 敏感数据加密存储
- API 请求鉴权
- 定期备份策略

---

## 5. 非功能性需求

### 5.1 性能要求

| 指标 | 目标值 |
|-----|--------|
| 页面加载时间 | < 2 秒 |
| API 响应时间 | < 3 秒 |
| 并发用户数 | 1000 |
| AI 生成响应时间 | < 30 秒 |

### 5.2 可用性要求

- 系统可用性：99.5%
- 服务支持时间：7x24 小时
- 错误率：< 0.1%

### 5.3 兼容性要求

- 浏览器：Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- 设备：桌面端（1920x1080+），移动端（375x667+）
- 操作系统：Windows 10+, macOS 10.15+, iOS 14+, Android 10+

### 5.4 安全要求

- HTTPS 加密传输
- SQL 注入防护
- XSS 攻击防护
- CSRF 令牌验证

---

## 6. 功能优先级

### P0（必须有）
- 用户认证（登录/登出）
- 智能行程规划（表单 + AI 生成）
- 方案保存和列表
- 方案详情展示

### P1（应该有）
- 数字人导游
- 内容创作（卡片、明信片、歌单、文案）
- AI 对话
- 地图可视化

### P2（可以有）
- 分享功能
- 方案导出
- 社区互动

---

## 7. 成功指标

| 指标 | 目标值 |
|-----|--------|
| 用户注册率 | 10% |
| 方案生成成功率 | 95% |
| 平均使用时长 | 15 分钟 |
| 方案保存率 | 60% |
| 用户满意度 | 4.5/5 |

---

## 8. 风险与限制

### 8.1 技术风险
- AI 模型响应不稳定
- 第三方 API 限流
- 地图 API 配额限制

### 8.2 业务风险
- 用户隐私数据保护
- AI 生成内容准确性
- 季节性流量波动

### 8.3 依赖限制
- Supabase 免费版限制
- DeepSeek API 限额
- 高德地图 API 配额

---

## 9. 未来规划

### V1.1（Q2 2026）
- 社交分享功能
- 方案导出（PDF/Word）
- 用户偏好学习

### V1.2（Q3 2026）
- 实时协作编辑
- AR 景点识别
- 智能预算优化

### V2.0（Q4 2026）
- 小程序版本
- 本地化（多语言）
- 企业定制版

---

**文档结束**
